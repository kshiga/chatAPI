<!DOCTYPE html>
<html>
  <head>
  <title>Chat Logger</title>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">



  </head>

  <body>
      <div class="row">
          <div class="col-md-12">
              <div>
                  <h1>POST</h1>
                  <form id="chat-post">
                      <div class="form-group">
                          <label for="type"> Type </label>
                          <select name="type" class="form-control enter comment highfive leave" id="type" >
                              <option value="enter">Enter</option>
                              <option value="comment">Comment</option>
                              <option value="highfive">High Five</option>
                              <option value="leave">Leave</option>
                          </select>
                      </div>
                      <div class="form-group">
                          <label for="user"> User </label>
                          <select name="user" class="form-control enter comment highfive leave" id="user">
                              <option value="A">A</option>
                              <option value="B">B</option>
                              <option value="C">C</option>
                              <option value="D">D</option>
                          </select>
                      </div>
                      <div class="form-group hide" id="other-user-group">
                          <label for="otheruser"> Other User </label>
                          <select name="otheruser" class="form-control highfive" id="otheruser">
                              <option value="A">A</option>
                              <option value="B">B</option>
                              <option value="C">C</option>
                              <option value="D">D</option>
                          </select>
                      </div>
                      <div class="form-group hide" id="message-group">
                          <label for="message"> Message </label>
                          <textarea name="message" class="form-control comment" id="message" rows="5"></textarea>
                      </div>
                      <input type="submit">
                  </form>
              </div>
              <div>
                  <h1>GET</h1>
              </div>
          </div>
      </div>
      <!-- Latest compiled and minified JavaScript -->
      <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
      <script>
          $("#type").change(function(event){
              var type = $(event.target).val();
              switch(type){
                case "enter":
                case "leave":
                    $("#other-user-group, #message-group").addClass('hide');
                break;
                case "highfive":
                    $("#other-user-group").removeClass('hide');
                    $("#message-group").addClass('hide');
                break;
                case "comment":
                    $("#other-user-group").addClass('hide');
                    $("#message-group").removeClass('hide');
                break;

              }
          });
          $("#chat-post").submit(function(event){
            event.preventDefault();
            var type = $("#type").val(),
                data = getFormData($("#chat-post").find('.'+type)),
                date = new Date();
            data.date =  toShortISOString(date);
            console.log(data);
            $.postJSON("/event", data, function(res){
              console.log(res)
            });

          })
          function getFormData($form){
              var unindexed_array = $form.serializeArray();
              var indexed_array = {};

              $.map(unindexed_array, function(n, i){
                  indexed_array[n['name']] = n['value'];
              });

              return indexed_array;
          }
          function toShortISOString(date) {
              return date.getUTCFullYear() +
              "-" + (date.getUTCMonth() + 1) +
              "-" + date.getUTCDate() +
              "T" + date.getUTCHours() +
              ":" + date.getUTCMinutes() +
              ":" + date.getUTCSeconds() +
              //Remove the milliseconds.
              //"." + String( (this.getUTCMilliseconds()/1000).toFixed(3)).slice(2, 5) +
              "Z";
          }
          $.postJSON = function(url, data, callback) {
              return jQuery.ajax({
                  'type': 'POST',
                  'url': url,
                  'contentType': 'application/json',
                  'data': JSON.stringify(data),
                  'dataType': 'json',
                  'success': callback
              });
          };
      </script>
  </body>

</html>
